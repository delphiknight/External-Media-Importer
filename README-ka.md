[English](README.md) | **[ქართული (Georgian)](README-ka.md)**

# გარე მედია იმპორტერი (External Media Importer)

WordPress-ის პლაგინი, რომელიც სკანირებს პოსტებს გარე მედია ფაილების URL-ებისთვის და იმპორტირებს მათ WordPress-ის მედია ბიბლიოთეკაში. პლაგინი ავტომატურად აღმოაჩენს გარე სერვერებზე განთავსებულ ფაილებს, ჩამოტვირთავს მათ და შეცვლის ძველ URL-ებს ახალი, ლოკალური მისამართებით.

**ვერსია:** 1.0.29
**საჭირო WordPress:** 5.0 ან უფრო ახალი
**საჭირო PHP:** 7.2 ან უფრო ახალი
**ლიცენზია:** GPL v2 ან უფრო გვიანდელი
**ავტორი:** დიმიტრი გოგელია (Dimitri Gogelia) — [gogelia.ge](https://gogelia.ge)

---

## ფუნქციები

1. **პარტიული სკანირება** — პოსტების სკანირება პარტიებით (10-200, ნაგულისხმევი 50). მონაცემთა ბაზის დონეზე SQL წინასწარი ფილტრაცია, რომელიც გამოტოვებს იმ პოსტებს, სადაც გარე ბმულები არ არის.

2. **URL-ების ამოცნობის 5 სტრატეგია:**
   - **სტრატეგია 1:** Regex შაბლონით URL-ების მოძებნა ტექსტში
   - **სტრატეგია 2+3:** HTML ტეგების გარჩევა — `<img src>`, `<video src>`, `<audio src>`, `<source src>`, `<a href>` ტეგებიდან URL-ების ამოღება
   - **სტრატეგია 4:** `srcset` ატრიბუტის გარჩევა `<img>` და `<source>` ტეგებზე (მძიმით გამოყოფილი ჩანაწერები სიგანის/პიქსელის აღმწერებით)
   - **სტრატეგია 5:** CSS `background-image: url()` გარჩევა ინლაინ სტილებსა და `<style>` ბლოკებში

3. **მედია ბიბლიოთეკაში იმპორტი** — გარე ფაილების ჩამოტვირთვა, WordPress-ის მიმაგრებების (attachment) შექმნა და პოსტებში ძველი URL-ების ახლით შეცვლა.

4. **URL-ების ჭკვიანი შეცვლა** — HTML entity-encoded (`&amp;`), URL-encoded (`%20`), სრულად დაშიფრული და protocol-relative (`//`) URL ვარიანტების მხარდაჭერა.

5. **პოსტის ტიპის არჩევა** — ნებისმიერი რეგისტრირებული საჯარო პოსტის ტიპის (post, page, და სხვა) სკანირება.

6. **პოსტის სტატუსის ფილტრი** — სკანირების შეზღუდვა კონკრეტული სტატუსებით: გამოქვეყნებული (publish), მონახაზი (draft), მოლოდინში (pending), პირადი (private), დაგეგმილი (future).

7. **სწრაფი სკანირება** — ერთი კონკრეტული პოსტის სკანირება ID ნომრით ან URL მისამართით.

8. **დუბლიკატების პრევენცია** — უკვე იმპორტირებული ფაილები ნაჩვენებია ბეჯით და ჩამოხაზვით, ნაგულისხმევად მოუნიშნავი.

9. **მკვდარი ბმულების აღმოჩენა** — HTTP შეცდომის მქონე ფაილები მონიშნულია როგორც მკვდარი ბმულები. პოსტები, სადაც ყველა ფაილი მკვდარია ან უკვე იმპორტირებული, ავტომატურად გამოირიცხება შედეგებიდან.

10. **შეწყვეტილი სკანირების გაგრძელება** — სკანირების მდგომარეობა ინახება localStorage-ში. გვერდის ხელახლა ჩატვირთვისას ნაჩვენებია გაგრძელების ბანერი.

11. **საცდელი გაშვება (Dry Run)** — HEAD მოთხოვნებით ფაილების ზომების შემოწმება იმპორტის გარეშე. ნაჩვენებია ინდივიდუალური ზომები და ჯამური სტატისტიკა.

12. **იმპორტის პროგრესი** — რეალურ დროში პროგრეს ბარი, რომელიც აჩვენებს იმპორტის მიმდინარეობას.

13. **იმპორტის ჟურნალი** — ჟურნალის ჩანაწერები პაგინაციით (50 ჩანაწერი გვერდზე) და სტატუსის ფილტრებით (ყველა/წარმატებული/შეცდომა/გამოტოვებული).

14. **ჟურნალის CSV ექსპორტი** — ჟურნალის ჩამოტვირთვა CSV ფორმატში, მიმდინარე სტატუსის ფილტრის გათვალისწინებით.

15. **წარუმატებელი იმპორტის ხელახალი ცდა** — ღილაკი ყველა წარუმატებელი იმპორტის ხელახლა გაშვებისთვის, პროგრეს ბარით.

16. **პანელი (Dashboard)** — სტატისტიკის მიმოხილვა: ჯამური/წარმატებული/შეცდომების/გამოტოვებულის რაოდენობა, დისკის მოხმარება, ხშირი შეცდომები.

17. **ფაილის ტიპების კონფიგურაცია** — Select2 ტეგირების რეჟიმით ფაილის გაფართოებების მართვა (jpg, pdf, docx და ა.შ.).

18. **მრავალი გარე URL ფილტრი** — Select2 ტეგირებით მრავალი საბაზისო URL-ის მითითება. მხოლოდ ამ URL-ებით დაწყებული ბმულები ჩაითვლება.

19. **პარტიის ზომის კონფიგურაცია** — სკანირების პარტიის ზომა 10-დან 200-მდე, პარამეტრების გვერდიდან.

20. **უფლებების დონეები** — პლაგინზე წვდომა მხოლოდ ადმინისტრატორებისთვის (`manage_options`) ან რედაქტორებისა და ზემოთ (`edit_posts`).

21. **ლოკალიზაცია** — სრული ინტერნაციონალიზაცია (i18n). ჩაშენებული ენები: ინგლისური და ქართული.

22. **სუფთა წაშლა** — პლაგინის წაშლისას მონაცემთა ბაზის ცხრილი და ყველა დაკავშირებული ოფცია ავტომატურად წაიშლება.

---

## ინსტალაცია

1. ჩამოტვირთეთ პლაგინის არქივი ან კლონირება გაუკეთეთ რეპოზიტორიას.
2. ატვირთეთ `external-media-importer` საქაღალდე `/wp-content/plugins/` დირექტორიაში.
3. გააქტიურეთ პლაგინი WordPress-ის ადმინ პანელიდან: **პლაგინები → დაინსტალირებული პლაგინები**.
4. გააქტიურების შემდეგ მენიუში გამოჩნდება **"მედია იმპორტერი"** (Media Importer) პუნქტი.

---

## გამოყენება

### პოსტების სკანირება

მთავარ გვერდზე აირჩიეთ პოსტის ტიპი (post, page ან სხვა საჯარო ტიპი) და სასურველი სტატუსები (გამოქვეყნებული, მონახაზი და ა.შ.). დააჭირეთ **"სკანირება"** ღილაკს. პლაგინი პარტიებად დაამუშავებს პოსტებს და SQL წინასწარი ფილტრაციით გამოტოვებს იმ პოსტებს, რომლებშიც გარე ბმულები არ მოიძებნება. სკანირების შედეგები ნაჩვენები იქნება ცხრილის სახით, სადაც თითოეულ ფაილთან არის ჩარჩო ასარჩევად.

### ფაილების იმპორტი

სკანირების შედეგებში მონიშნეთ სასურველი ფაილები (ან აირჩიეთ ყველა) და დააჭირეთ **"იმპორტი"** ღილაკს. პლაგინი თანმიმდევრულად ჩამოტვირთავს თითოეულ ფაილს, შექმნის WordPress-ის მიმაგრებას მედია ბიბლიოთეკაში და შეცვლის ძველ URL-ს ახალი ლოკალური მისამართით. პროგრეს ბარი აჩვენებს მიმდინარეობას რეალურ დროში.

### სწრაფი სკანირება

მთავარ გვერდზე **"სწრაფი სკანირება"** ველში შეიყვანეთ პოსტის ID ნომერი ან სრული URL მისამართი. პლაგინი ავტომატურად ამოიცნობს პოსტს (URL-ის შემთხვევაში `url_to_postid()` ფუნქციით) და დაასკანირებს მას. შედეგები ნაჩვენებია იმავე ცხრილის ფორმატში იმპორტის კონტროლებით.

### საცდელი გაშვება (Dry Run)

სკანირების შედეგებში მონიშნეთ ფაილები და დააჭირეთ **"საცდელი გაშვება"** ღილაკს. პლაგინი HTTP HEAD მოთხოვნებს გაუგზავნის სერვერს თითოეული ფაილისთვის და აჩვენებს ფაილის ზომას ლურჯი ბეჯის სახით. დასრულების შემდეგ ნაჩვენებია ჯამური სტატისტიკა — ფაილების რაოდენობა და საერთო ზომა.

### სკანირების გაგრძელება

თუ სკანირება შეწყდა (გვერდის დახურვა, ბრაუზერის გადატვირთვა და ა.შ.), პლაგინი ინახავს მიმდინარე მდგომარეობას localStorage-ში. გვერდის ხელახლა გახსნისას გამოჩნდება ბანერი, რომელიც შემოგთავაზებთ სკანირების გაგრძელებას იმ ადგილიდან, სადაც შეჩერდა. ასევე შეგიძლიათ უარყოთ და ახალი სკანირება დაიწყოთ.

---

## პარამეტრები

პარამეტრების გვერდი ხელმისაწვდომია **"მედია იმპორტერი" → "პარამეტრები"** მენიუდან.

### ფაილის ტიპები
Select2 ტეგირების რეჟიმით შეგიძლიათ დაამატოთ ან წაშალოთ ფაილის გაფართოებები, რომლებსაც პლაგინი ეძებს (მაგ.: jpg, png, pdf, docx, mp4, zip). ახალი გაფართოების დასამატებლად უბრალოდ აკრიფეთ და დააჭირეთ Enter-ს.

### გარე URL-ები
Select2 ტეგირების რეჟიმით მიუთითეთ ერთი ან მეტი გარე საბაზისო URL. პლაგინი მხოლოდ იმ ბმულებს დაამუშავებს, რომლებიც ამ URL-ებით იწყება (starts-with შედარება). თუ ცარიელია, ყველა გარე URL ჩაითვლება.

### პარტიის ზომა
რიცხვითი ველი, რომელიც განსაზღვრავს ერთ AJAX მოთხოვნაში რამდენი პოსტი დამუშავდება. მნიშვნელობა 10-დან 200-მდე, ნაგულისხმევი — 50.

### უფლებები
ჩამოსაშლელი სიით აირჩიეთ ვის აქვს პლაგინზე წვდომა:
- **მხოლოდ ადმინისტრატორები** (`manage_options`) — ნაგულისხმევი
- **რედაქტორები და ზემოთ** (`edit_posts`)

### მონაცემების მართვა
- **ჟურნალის გასუფთავება** — ყველა ჟურნალის ჩანაწერის წაშლა. ნაჩვენებია ჩანაწერების რაოდენობა, დადასტურების დიალოგით.

---

## პანელი და ჟურნალი

### პანელი (Dashboard)

პანელის გვერდი (**"მედია იმპორტერი" → "პანელი"**) აჩვენებს სტატისტიკის ბარათებს:

- **მიმოხილვა** — ჯამური იმპორტის რაოდენობა, წარმატებული, შეცდომა და გამოტოვებული, პროცენტებით.
- **შენახვა** — დისკის მოხმარება იმპორტირებული ფაილებისთვის და უნიკალური პოსტების რაოდენობა. დისკის ზომა ქეშირებულია 1-საათიანი transient-ით.
- **ხშირი შეცდომები** — ტოპ 5 შეცდომის შეტყობინება სიხშირის მიხედვით.

ცარიელი მდგომარეობისას ნაჩვენებია შეტყობინება ბმულით მთავარ სკანირების გვერდზე.

### ჟურნალის ნახვა და ფილტრაცია

ჟურნალის გვერდი (**"მედია იმპორტერი" → "ჟურნალი"**) აჩვენებს ყველა იმპორტის ჩანაწერს პაგინაციით (50 ჩანაწერი გვერდზე). სტატუსის ჩანართებით შეგიძლიათ გაფილტროთ: ყველა, წარმატებული (success), შეცდომა (error), გამოტოვებული (skipped). თითოეული ჩანართი აჩვენებს შესაბამის რაოდენობას.

### CSV ექსპორტი

ჟურნალის გვერდზე **"CSV ექსპორტი"** ღილაკით ჩამოტვირთეთ ჟურნალი CSV ფორმატში. ექსპორტი ითვალისწინებს მიმდინარე სტატუსის ფილტრს — თუ აქტიურია "შეცდომა" ჩანართი, მხოლოდ შეცდომის ჩანაწერები ჩამოიტვირთება.

### წარუმატებელი იმპორტის ხელახალი ცდა

ჟურნალის გვერდზე **"წარუმატებელის ხელახალი ცდა"** ღილაკი იტვირთავს ყველა შეცდომის სტატუსის ჩანაწერს და თანმიმდევრულად ცდის ხელახლა იმპორტს. ძველი შეცდომის ჩანაწერი იშლება ახალი მცდელობის წინ. დასრულების შემდეგ გვერდი ავტომატურად განახლდება.

---

## თარგმნა

პლაგინი მხარს უჭერს სრულ ლოკალიზაციას WordPress-ის სტანდარტული i18n სისტემით.

### შემავალი ენები

- **ინგლისური** (en_US) — ნაგულისხმევი ენა
- **ქართული** (ka_GE) — სრული თარგმანი

### ახალი თარგმანის დამატება

1. გამოიყენეთ `languages/external-media-importer.pot` შაბლონის ფაილი.
2. შექმენით `.po` ფაილი თქვენი ენისთვის (მაგ.: `external-media-importer-de_DE.po`).
3. კომპილაცია გაუკეთეთ `.mo` ფაილად Poedit-ით ან `wp i18n make-mo` ბრძანებით.
4. განათავსეთ ფაილები `languages/` საქაღალდეში.

პლაგინი ავტომატურად ჩატვირთავს სწორ თარგმანს WordPress-ის ენის პარამეტრის მიხედვით.

---

## ცვლილებების ისტორია

### 1.0.29
- ლოკალიზაცია და დოკუმენტაცია: სრული i18n მხარდაჭერა, PHP და JS სტრიქონების თარგმნა, `load_plugin_textdomain()`, `.pot` შაბლონი, ქართული `ka_GE.po/.mo`, README ფაილები

### 1.0.28
- `srcset` და CSS `background-image` სკანირება: სტრატეგია 4 — `srcset` ატრიბუტის გარჩევა `<img>` და `<source>` ტეგებზე; სტრატეგია 5 — CSS `background-image: url()` გარჩევა ინლაინ სტილებსა და `<style>` ბლოკებში

### 1.0.27
- მრავალი გარე URL ფილტრი: Select2 ტეგირების რეჟიმი, მძიმით გამოყოფილი URL-ები, starts-with შედარება, ძველ მნიშვნელობებთან თავსებადობა

### 1.0.26
- კონფიგურირებადი უფლებების დონე: ადმინისტრატორები (`manage_options`) ან რედაქტორები (`edit_posts`), ჩამოსაშლელი სია პარამეტრებში

### 1.0.25
- იმპორტის სტატისტიკის პანელი: ახალი ქვემენიუ გვერდი სტატისტიკის ბარათებით, დისკის მოხმარება, ხშირი შეცდომები, რესპონსიული CSS ბადე

### 1.0.24
- საცდელი გაშვების პროგრეს ბარი: თანმიმდევრული URL დამუშავება პროგრეს ბარით, `formatBytes()` ფუნქცია

### 1.0.23
- საცდელი გაშვების რეჟიმი: HEAD მოთხოვნები ფაილის ზომების შემოწმებისთვის, ლურჯი ბეჯები ზომებით, ჯამური სტატისტიკა

### 1.0.22
- ინდივიდუალური nonce ვერიფიკაცია: 8 ცალკეული nonce საერთოს ნაცვლად, `emiAjax.nonces` ობიექტი

### 1.0.21
- მედია ტეგების გარჩევა: `<img src>`, `<video src>`, `<audio src>`, `<source src>` ამოცნობა, დედუპლიკაცია `$seen_urls`-ით

### 1.0.20
- კონფიგურირებადი პარტიის ზომა: რიცხვითი ველი პარამეტრებში (10–200), `emi_batch_size` ოფცია

### 1.0.19
- წარუმატებელი იმპორტის ხელახალი ცდა: ღილაკი ჟურნალის გვერდზე, ძველი შეცდომის ჩანაწერის წაშლა ხელახალი მცდელობის წინ

### 1.0.18
- ჟურნალის CSV ექსპორტი: ჩამოტვირთვის ღილაკი, სტატუსის ფილტრის გათვალისწინება, UTF-8 CSV

### 1.0.17
- სწრაფი სკანირება: ტექსტური ველი პოსტის ID-ით ან URL-ით, `url_to_postid()` ამოცნობა

### 1.0.16
- პოსტის სტატუსის ფილტრი: ჩარჩოები publish/draft/pending/private/future სტატუსებისთვის, SQL `IN (...)` მოთხოვნა

### 1.0.15
- მკვდარი ბმულების გამოტოვება: `skipped` ჩანაწერების აღმოჩენა, მკვდარი ბმულების წითელი ბეჯი, სრულად მკვდარი პოსტების ავტომატური გამორიცხვა

### 1.0.14
- შეწყვეტილი სკანირების გაგრძელება: localStorage-ში მდგომარეობის შენახვა, გაგრძელების ბანერი, უარყოფის ოფცია

### 1.0.13
- "ჟურნალის გასუფთავება" ღილაკი გადატანილია პარამეტრების გვერდზე "მონაცემების მართვის" სექციაში

### 1.0.12
- ჟურნალის გასუფთავების ღილაკი ჟურნალის გვერდზე

### 1.0.11
- SQL წინასწარი ფილტრი: `LIKE` მოთხოვნა მონაცემთა ბაზის დონეზე, გარე ბმულების გარეშე პოსტების გამოტოვება

### 1.0.10
- ჟურნალის პაგინაცია (50 ჩანაწერი გვერდზე), სტატუსის ფილტრის ჩანართები რაოდენობებით

### 1.0.9
- დუბლიკატების პრევენცია: უკვე იმპორტირებული ფაილები ბეჯით და ჩამოხაზვით, სერვერის მხარეს შემოწმება

### 1.0.8
- URL-ების შეცვლის გაუმჯობესება: HTML entity-encoded, URL-encoded, სრულად დაშიფრული და protocol-relative ვარიანტების მხარდაჭერა

### 1.0.7
- წაშლის hook: მონაცემთა ბაზის ცხრილის და ოფციების წაშლა პლაგინის დეინსტალაციისას

### 1.0.6
- `upload_dir` ფილტრის სწორად გასუფთავება: closure ცვლადში, `remove_filter()` გამოყენება

### 1.0.5
- Select2 მრავალჯერადი არჩევა ფაილის ტიპებისთვის პარამეტრების გვერდზე, ტეგირების რეჟიმით

### 1.0.4
- `<a href>` ტეგის გარჩევა regex-თან ერთად, საერთო `extract_external_urls()` მეთოდის გამოყოფა

### 1.0.3
- პროგრეს ბარის ხილვადობის გასწორება, პარტიული სკანირების დანერგვა (50 პოსტი AJAX მოთხოვნაზე)

### 1.0.2
- პლაგინის სათაურის განახლება WordPress-ის სტანდარტებით, ავტორის დამატება

### 1.0.1
- Regex გაფართოებების დალაგება სიგრძის კლებადობით (`usort()`) — docx/doc, xlsx/xls სწორი ამოცნობა

### 1.0.0
- საწყისი ვერსია: OOP კლასზე დაფუძნებული WordPress პლაგინი გარე მედია ფაილების სკანირებისა და იმპორტისთვის

---

## მოთხოვნები

- WordPress 5.0 ან უფრო ახალი
- PHP 7.2 ან უფრო ახალი
- MySQL/MariaDB (WordPress-ის სტანდარტული მონაცემთა ბაზა)

---

## ხშირად დასმული კითხვები

**რა ხდება პლაგინის წაშლისას?**
პლაგინი სრულად ასუფთავებს თავის მონაცემებს: წაიშლება `wp_external_media_log` ცხრილი და ყველა ოფცია (`emi_file_types`, `emi_external_url`, `emi_batch_size`, `emi_capability`).

**შეიძლება მხოლოდ კონკრეტული დომენიდან ფაილების იმპორტი?**
დიახ. პარამეტრების გვერდზე "გარე URL-ები" ველში მიუთითეთ სასურველი დომენ(ებ)ის URL. პლაგინი მხოლოდ ამ URL-ებით დაწყებულ ბმულებს დაამუშავებს.

**რა ტიპის ფაილების იმპორტი შეიძლება?**
ნაგულისხმევად: jpg, jpeg, png, gif, pdf, doc, docx, zip, mp4, mp3. პარამეტრების გვერდიდან შეგიძლიათ დაამატოთ ან წაშალოთ ნებისმიერი გაფართოება.

**უსაფრთხოა თუ არა დიდი რაოდენობის ფაილების იმპორტი?**
პლაგინი პარტიული სკანირებისა და თანმიმდევრული იმპორტის მეთოდს იყენებს, რაც თავიდან აცილებს სერვერის გადატვირთვას. შეგიძლიათ პარტიის ზომა შეცვალოთ 10-დან 200-მდე. შეწყვეტილი სკანირების გაგრძელებაც შესაძლებელია.

---

## ლიცენზია

ეს პლაგინი ლიცენზირებულია [GNU General Public License v2](https://www.gnu.org/licenses/gpl-2.0.html) ან უფრო გვიანდელი ვერსიით.

---

## ავტორი

**დიმიტრი გოგელია** (Dimitri Gogelia)
[https://gogelia.ge](https://gogelia.ge)
